## 计算机网络

### 什么是Ping?

Ping是 ICMP 的一个重要应用，主要用来测试两个主机直接的连通性。（ping 属于网络层）

### Ping的原理

Ping的原理是通过向主机发送ICMP Echo 请求报文，目的主机收到后会发送 Echo 回答报文。Ping 会根据时间和成功响应的次数估算出数据包往返时间以及丢包率。

Echo (回送)  用途是为了请求或者回答。

### 什么是ICMP？

ICMP叫 *网际控制报文协议*，是为了更有效地转发IP数据报和提高交付成功的机会。它封装在IP数据报中，但是不是高层协议。

### TCP 的三次握手？

![img](C:\Users\Administrator\Desktop\notes\assets\e92d0ebc-7d46-413b-aec1-34a39602f787.png)

首先服务器处于监听状态，等待客户端的连接。客户端向服务器发送连接请求报文，此时报文中同步序号字段SYN=1，确认字段ACK=0，服务端在收到客户端的请求报文之后，如果同意连接，则向客户端发送确认报文，此时报文中同步字段SYN=1，确认字段ACK=1。客户端在收到服务器的确认报文后，再向服务端发送一个确认报文，此时确认字段ACK=1，服务端在收到客户端的确认报文后，连接建立。

### 为什么要进行三次握手

前两次握手是因为正常的请求和确认。第三次握手是为了防止失效的连接请求到达服务端，让服务端错误地连接。客户端发送的连接请求如果在网络中滞留，那么客户端就会隔很长一段时间才能接收到服务端传回的确认报文。客户端在等待一个超时重传之后，会重新发送请求报文。但是这个滞留的连接报文最后依然会到达服务端，如果不进行三次握手，那么服务端就会打开两个连接。如果进行三次握手，客户端和服务端连接后，会忽略服务端之后发送的对滞留连接请求的确认报文。

### TCP的四次挥手？

![img](C:\Users\Administrator\Desktop\notes\assets\f87afe72-c2df-4c12-ac03-9b8d581a8af8.jpg)

四次挥手的过程：客户端向服务端发送请求释放连接的报文，此时报文中代表终止的字段FIN=1，确认字段ACK在确认连接后一直为1，在连接完全断开后才变成0。服务端收到客户端的请求后之后发出确认报文，此时服务端处于半关闭状态，即服务端能向客户端发送数据但是客户端不能向服务端发送数据。当服务端不需要连接之后，服务端向客户端发送请求释放报文，此时终止字段FIN=1，客户端收到服务端的请求释放报文后，发出确认报文，同时进入TIME-WAIT状态，等待两个最大报文存活时间后发送释放连接确认报文。服务端收到客户端的确认后释放连接。

### 为什么要进行四次挥手？

四次挥手的主要原因是为了让服务端发送完还未传输完毕的数据和让所有属于该连接的报文在连接断开时从网络中消失，以免影响下一个新的连接。

客户端发送了终止字段FIN为1的请求连接释放报文之后，服务端收到了这个报文，进入CLOSE-WAIT状态，这个状态是为了让服务端发送还未传送完毕的数据，传送完毕后，服务器会发送FIN字段为1的确认连接释放报文。客户端在收到服务器发送而来的释放报文之后，并不直接进入CLOSE状态，而是进入TIME-WAIT状态，等待两个最大报文存活的时间，这样做是有两个目的，第一个目的是确认最后的确认报文能够到达。如果服务端没收到客户端发来的最后的确认报文，客户端重新发送释放连接的确认报文。第二个目的是，等一段时间，让此连接时间内产生的所有报文都从网络中消失，以免下一个新的连接中会出现旧的连接请求报文。

### 拥塞控制

当网络中的负载越来越强，那么网络就会拥塞，数据会在网络中滞留，此时发送方会超时重传，导致拥塞程度变得更高。此时应该控制发送方的发送速率，这就得用到拥塞控制。

TCP主要通过四个算法进行拥塞控制，慢启动、拥塞避免、快重传、快恢复

1. 慢启动和拥塞避免。刚开始时发送方执行慢开始，拥塞窗口为1，即每次只能发送一个报文段，收到确认报文后，拥塞窗口翻倍，即一次发送两个报文段，每轮翻倍。由于每次翻倍，所以刚开始启动的时候增长非常快，当增长到一个门限值之后，进入拥塞避免阶段，每次拥塞窗口增加1。随着增加，如果出现了报文传输超时，则将门限值设为此时的拥塞窗口的一半，重新开始慢启动。
2. 快重传和快恢复。每次接收到报文段都对最后一个连续的报文段进行确认。如果在发送方收到三个重复确认，可以知道下一个报文段丢失，此时执行快重传，立刻重传下一个报文段。然后执行快恢复，令门限值等于拥塞窗口的一半，然后拥塞窗口等于此门限值，进入拥塞避免阶段。

### 为什么UDP不可靠

UDP是面向无连接的服务，尽可能做到交付。支持一对一，一对多的通信。UDP没有拥塞控制，也没有超时重传的概念。TCP是利用超时重传来实现可靠性的传输的，如果将一个报文在超时时间内没有收到确认，就重传这个报文段，做到报文段不丢失。

